<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Photos near you</title>
    <script src="js/instajam/dist/instajam.js"></script>
    <script>
        'use strict';

        var photoWrapper;

        document.addEventListener("DOMContentLoaded", function() {
            // global.
            photoWrapper = document.getElementById('photo-wrapper');

            var currentPos, posError;

            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(geoLocSuccessHandler,
                    geoLocFailHandler);
            }
            else {
                posError = {message: 'Your browser does not support geo location, please upgrade.'};
                geoLocFailHandler(posError);
            }
        });

        var geoLocSuccessHandler = function(pos) {
            requestNewPhotos(pos.coords.latitude, pos.coords.longitude);
        }

        var geoLocFailHandler = function(posError) {
            alert(posError.message);
        }

        var requestNewPhotos = function(lat, lng) {
            var IG = new Instajam({
                clientID: 'YOUR_CLIENT_ID_HERE',
            });

            IG.media.search({lat:lat, lng: lng, distance:100}, updateDisplay);
        }

        var updateDisplay = function (response) {
            console.log(response);
            if (response.meta.code === 200) {
                showConnectionWarning(false);
                response.data.forEach(displayMedia);
            }
            else {
                showConnectionWarning(true);
            }
        };

        var displayMedia = function (media) {
            var elImg = document.createElement("img");
            elImg.src = media.images.low_resolution.url;
            elImg.height = media.images.low_resolution.height;
            elImg.width = media.images.low_resolution.width;

            var title = document.createTextNode("View ");
            if (media.caption != null) {
                title.appendData(media.caption.text);
            }
            title.appendData(" on Instagram");

            var elLink = document.createElement("a");
            elLink.href = media.link;
            elLink.title = title.data;
            elLink.appendChild(elImg);

            photoWrapper.appendChild(elLink);
        }

        var showConnectionWarning = function(show)
        {
        }
    </script>
</head>

<body>
    <h1>Photos near you</h1>
    <div id="photo-wrapper">
    </div>
</body>
</html>
